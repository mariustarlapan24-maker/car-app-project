<%- include('partials/header', { title: 'Acasă' }) %>

<div class="container mt-5">
    <% if (typeof success !== 'undefined' && success) { %>
        <div class="alert alert-success text-center">Mașină înregistrată!</div>
    <% } %>

    <div class="row justify-content-center mb-5">
        <div class="col-md-6 position-relative">
            <div class="input-group shadow rounded-pill bg-white overflow-hidden">
                <span class="input-group-text bg-white border-0 fw-bold px-3">MD</span>
                <input type="text" id="plate-search" class="form-control border-0 py-3" placeholder="Caută ABC123" maxlength="6" autocomplete="off">
                <button id="clear-search" class="btn border-0 px-3">X</button>
            </div>
            <ul id="search-results" class="list-group position-absolute w-100 mt-1 shadow-lg z-3" style="display:none;"></ul>
        </div>
    </div>

    <div class="row row-cols-2 row-cols-md-4 g-3" id="cars-grid">
        <% cars.forEach(car => { %>
            <div class="col car-item" data-plate="<%= car.plateNumber %>">
                <div class="card h-100 border-0 shadow-sm">
                    <img src="<%= car.imageUrls[0] %>" class="card-img-top" style="height:120px; object-fit:cover;">
                    <div class="card-body p-2 text-center">
                        <div class="fw-bold text-primary"><%= car.plateNumber %></div>
                        <small><%= car.make %> <%= car.model %></small>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<script>
    const search = document.getElementById('plate-search');
    const results = document.getElementById('search-results');
    const items = document.querySelectorAll('.car-item');

    search.addEventListener('input', async function() {
        this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        let v = this.value;

        // Filtrare grid
        items.forEach(it => it.style.display = it.getAttribute('data-plate').includes(v) ? 'block' : 'none');

        // Sugestii API
        if (v.length >= 2) {
            const res = await fetch(`/api/search?plate=${v}`);
            const data = await res.json();
            results.innerHTML = data.map(c => `<a href="#" class="list-group-item list-group-item-action">${c.plateNumber} - ${c.make}</a>`).join('');
            results.style.display = 'block';
        } else {
            results.style.display = 'none';
        }
    });

    document.getElementById('clear-search').addEventListener('click', () => {
        search.value = '';
        results.style.display = 'none';
        items.forEach(it => it.style.display = 'block');
    });
</script>
<%- include('partials/footer') %>