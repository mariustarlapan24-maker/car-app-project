<%- include('partials/header', { title: 'Adaugă Mașină' }) %>
<div class="row justify-content-center mt-5">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow-lg p-4 border-0">
            <h2 class="card-title text-center mb-4 fw-bold">Adaugă o Mașină</h2>
            <form action="/add-car" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="plateNumber" class="form-label fw-bold">Număr de Înmatriculare</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <img src="/img/drapel-md.png" style="width: 20px;">
                            <span class="fw-bold">MD</span>
                        </span>
                        <input type="text" name="plateNumber" id="plateNumber" class="form-control form-control-lg" placeholder="Ex: ABC 123" required maxlength="7">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="make" class="form-label fw-bold">Marca</label>
                    <select name="make" id="make" class="form-select" required>
                        <option value="" disabled selected>Selectează marca…</option>
                        <option value="Audi">Audi</option>
                        <option value="BMW">BMW</option>
                        <option value="Mercedes">Mercedes</option>
                        <option value="Volkswagen">Volkswagen</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="model" class="form-label fw-bold">Modelul</label>
                    <select name="model" id="model" class="form-select" required>
                        <option value="" disabled selected>Selectează modelul…</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="carImage" class="form-label fw-bold">Imagini (Max 3)</label>
                    <input type="file" name="carImage" id="carImage" class="form-control" accept="image/*" multiple required>
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-lg">Salvează Mașina</button>
            </form>
        </div>
    </div>
</div>

<script>
    const plateInput = document.getElementById('plateNumber');
    const makeSelect = document.getElementById('make');
    const modelSelect = document.getElementById('model');

    // Formatare număr în timp real fără blocaj
    plateInput.addEventListener('input', function (e) {
        let cursorPos = this.selectionStart;
        let val = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');

        if (val.length > 3) {
            val = val.substring(0, 3) + " " + val.substring(3, 6);
        }

        this.value = val.substring(0, 7); // limita la 7 caractere

        // Ajustăm cursorul după spațiu
        if (cursorPos === 4 && !val.includes(' ')) cursorPos++;
        this.setSelectionRange(cursorPos, cursorPos);
    });

    // Datele pentru modele auto
    const modelsData = {
        "Audi": ["A3","A4","A6","Q5"],
        "BMW": ["X1","X3","X5","M3"],
        "Mercedes": ["C200","E300","S500"],
        "Volkswagen": ["Golf","Passat","Tiguan"]
    };

    makeSelect.addEventListener('change', () => {
        modelSelect.innerHTML = '<option value="" disabled selected>Selectează modelul…</option>';
        const models = modelsData[makeSelect.value] || [];
        models.forEach(m => {
            const option = document.createElement('option');
            option.value = m;
            option.text = m;
            modelSelect.add(option);
        });
    });
</script>
<%- include('partials/footer') %>
