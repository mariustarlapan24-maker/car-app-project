<%- include('partials/header', { title: 'Adaugă Mașină' }) %>

<div class="row justify-content-center mt-5">
    <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow-lg p-4 border-0">
            <h2 class="card-title text-center mb-4 fw-bold">Adaugă o Mașină</h2>
            
            <% if(error) { %>
                <div class="alert alert-danger" role="alert"><%= error %></div>
            <% } %>
            
            <form action="/add-car" method="POST" enctype="multipart/form-data">
                
                <div class="mb-3">
                    <label for="plateNumber" class="form-label fw-bold">Număr de Înmatriculare</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">
                            <img src="/img/drapel-md.png" class="flag-icon me-1">
                            <span class="fw-bold">MD</span>
                        </span>
                        <input type="text" name="plateNumber" id="plateNumber" class="form-control form-control-lg" 
                               placeholder="Număr de Înmatriculare (Ex: ABC 123)" maxlength="7" required>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Tip Vehicul</label>
                    <input type="text" class="form-control" value="Mașină" disabled>
                </div>
                
                <div class="mb-3">
                    <label for="make" class="form-label fw-bold">Marca</label>
                    <select name="make" id="make" class="form-select" required>
                        <option value="" disabled selected>Selectează marca…</option>
                        <option value="Audi">Audi</option>
                        <option value="BMW">BMW</option>
                        <option value="Mercedes">Mercedes</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Honda">Honda</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="model" class="form-label fw-bold">Modelul</label>
                    <select name="model" id="model" class="form-select" required>
                        <option value="" disabled selected>Selectează modelul…</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="carImage" class="form-label fw-bold">Imagini Mașină (Minim 1, Maxim 3)</label>
                    <input type="file" name="carImage" id="carImage" class="form-control" accept="image/*" multiple required>
                    <div class="form-text">Selectează minim 1 și maxim 3 imagini.</div>
                </div>
                
                <button type="submit" class="btn btn-primary w-100 btn-lg">Salvează Mașina</button>
            </form>
        </div>
    </div>
</div>

<script>
const makeSelect = document.getElementById('make');
    const modelSelect = document.getElementById('model');
    const plateInput = document.getElementById('plateNumber'); // Selectăm câmpul de număr

    // --- 1. LOGICA PENTRU FORMATARE NUMĂR (Litere mari + Cifre) ---
    if (plateInput) {
        plateInput.addEventListener('input', function (e) {
            // Transformăm în litere mari și eliminăm tot ce nu e literă sau cifră
            let val = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            
            // Extragem primele 3 caractere (doar litere)
            let letters = val.slice(0, 3).replace(/[^A-Z]/g, '');
            
            // Extragem următoarele 3 caractere (doar cifre)
            // slice pornește exact de unde s-au terminat literele introduse
            let numbers = val.slice(letters.length, letters.length + 3).replace(/[^0-9]/g, '');
            
            // Reconstruim valoarea finală: Litere + Spațiu (dacă există cifre) + Cifre
            e.target.value = letters + (numbers.length > 0 ? " " : "") + numbers;
        });
    }

    // --- 2. LOGICA EXISTENTĂ PENTRU MODELE ---
    const modelsData = {
        "Audi": ["A3","A4","A6","Q5"],
        "BMW": ["X1","X3","X5","M3"],
        "Mercedes": ["C200","E300","S500"],
        "Volkswagen": ["Golf","Passat","Tiguan"],
        "Toyota": ["Corolla", "Camry", "RAV4"],
        "Honda": ["Civic", "Accord", "CR-V"]
    };

    if(makeSelect){
        makeSelect.addEventListener('change', () => {
            modelSelect.innerHTML = '<option value="" disabled selected>Selectează modelul…</option>';
            const models = modelsData[makeSelect.value] || [];
            models.forEach(m => {
                const option = document.createElement('option');
                option.value = m; option.text = m;
                modelSelect.add(option);
            });
        });
    }
// Validare pentru numărul de imagini
const carImageInput = document.getElementById('carImage');
if (carImageInput) {
    carImageInput.addEventListener('change', function() {
        if (this.files.length > 3) {
            alert("Poți selecta maxim 3 imagini!");
            this.value = ""; // Resetează selecția
        }
    });
}
</script>

<%- include('partials/footer') %>
