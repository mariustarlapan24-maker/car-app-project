<%- include('partials/header', { title: 'Chat' }) %>

<div class="chat-container">
    <h2>Mesaje</h2>
    <div id="messages"></div>
    <form id="chat-form">
        <input id="msg" type="text" placeholder="Scrie mesajul..." required autocomplete="off">
        <button type="submit">Trimite</button>
    </form>
</div>

<script>
const socket = io();
const roomId = "<%= roomId %>";
const userName = "<%= username %>";
socket.emit('joinRoom', roomId);

const form = document.getElementById('chat-form');
const messagesDiv = document.getElementById('messages');

form.addEventListener('submit', e => {
    e.preventDefault();
    const msg = document.getElementById('msg').value;
    socket.emit('chatMessage', { message: msg, senderName: userName, roomId });
    document.getElementById('msg').value = '';
});

socket.on('message', data => {
    const div = document.createElement('div');
    div.classList.add('chat-msg');
    div.innerHTML = `<strong>${data.sender}:</strong> ${data.text} <span class="time">${data.time}</span>`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
</script>

<%- include('partials/footer') %>
