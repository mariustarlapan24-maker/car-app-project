<%- include('partials/header', { title: 'Chat' }) %>

<div class="container mt-4">
    <h4>Chat (Mașina: <%= roomId %>)</h4>
    <div id="messages" class="border rounded p-3 mb-3" style="height:300px; overflow-y:auto;">
        <div class="text-muted">V-ați alăturat chat-ului.</div>
    </div>

    <form id="chatForm" class="d-flex">
        <input type="text" id="messageInput" class="form-control me-2" placeholder="Scrie un mesaj..." required>
        <button class="btn btn-primary" type="submit">Trimite</button>
    </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const userId = '<%= userId %>';
    const username = '<%= username %>';
    const roomId = '<%= roomId %>';

    const socket = io();
    socket.emit('joinRoom', roomId);

    const chatForm = document.getElementById('chatForm');
    const messageInput = document.getElementById('messageInput');
    const messagesArea = document.getElementById('messages');

    chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const message = messageInput.value;
        if (message) {
            socket.emit('chatMessage', { roomId, message, senderId: userId, senderName: username });
            messageInput.value = '';
        }
    });

    socket.on('message', (data) => {
        const messageElement = document.createElement('div');
        messageElement.classList.add('mb-2');
        messageElement.innerHTML = `<strong>${data.sender}:</strong> ${data.text} <small class="text-muted">${data.time}</small>`;
        messagesArea.appendChild(messageElement);
        messagesArea.scrollTop = messagesArea.scrollHeight;
    });
</script>

<%- include('partials/footer') %>
